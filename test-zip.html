<!DOCTYPE html>
<html>
<head>
  <title>ZIP Test</title>
  <script type="module">
    import { Zip, ZipPassThrough } from './node_modules/fflate/esm/browser.js';
    
    async function testZip() {
      console.log('ğŸ§ª Testing fflate ZIP generation...');
      
      const chunks = [];
      
      // ZIP ìƒì„±
      const zip = new Zip((err, data, final) => {
        if (err) {
          console.error('âŒ ZIP error:', err);
          return;
        }
        
        if (data && data.length > 0) {
          console.log('ğŸ“¦ Received chunk:', data.length, 'bytes');
          chunks.push(data);
        }
        
        if (final) {
          console.log('âœ… ZIP finalized');
          
          // ëª¨ë“  ì²­í¬ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°
          const totalSize = chunks.reduce((sum, chunk) => sum + chunk.length, 0);
          const zipData = new Uint8Array(totalSize);
          let offset = 0;
          for (const chunk of chunks) {
            zipData.set(chunk, offset);
            offset += chunk.length;
          }
          
          console.log('ğŸ“Š Total ZIP size:', zipData.length, 'bytes');
          
          // ZIP íŒŒì¼ ë‹¤ìš´ë¡œë“œ
          const blob = new Blob([zipData], { type: 'application/zip' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'test.zip';
          a.click();
          
          console.log('ğŸ’¾ ZIP file downloaded. Try to extract it!');
        }
      });
      
      // í…ŒìŠ¤íŠ¸ íŒŒì¼ 1
      const file1 = new ZipPassThrough('test1.txt');
      zip.add(file1);
      file1.push(new TextEncoder().encode('Hello from file 1!\n'), false);
      file1.push(new TextEncoder().encode('This is a test.\n'), false);
      file1.push(new Uint8Array(0), true); // íŒŒì¼ ì¢…ë£Œ
      
      // í…ŒìŠ¤íŠ¸ íŒŒì¼ 2
      const file2 = new ZipPassThrough('folder/test2.txt');
      zip.add(file2);
      file2.push(new TextEncoder().encode('Hello from file 2!\n'), false);
      file2.push(new TextEncoder().encode('Inside a folder.\n'), false);
      file2.push(new Uint8Array(0), true); // íŒŒì¼ ì¢…ë£Œ
      
      // ZIP ì¢…ë£Œ
      zip.end();
    }
    
    window.testZip = testZip;
    console.log('âœ… Test ready. Run: testZip()');
  </script>
</head>
<body>
  <h1>ZIP Test</h1>
  <button onclick="testZip()">Generate Test ZIP</button>
  <p>Open console and click the button. A ZIP file will be downloaded.</p>
  <p>Try to extract it with your system's ZIP tool.</p>
</body>
</html>
